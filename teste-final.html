<!DOCTYPE html>
<html>
<head>
    <title>Teste Final - Compartilhamento AMBI360</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .test-link { display: block; margin: 10px 0; padding: 10px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>üß™ Teste Final - Sistema de Compartilhamento</h1>
    
    <div id="status"></div>
    
    <h2>Etapas do Teste:</h2>
    <ol>
        <li>Gerar dados de teste</li>
        <li>Codificar em Base64</li>
        <li>Criar link de compartilhamento</li>
        <li>Testar decodifica√ß√£o</li>
        <li>Abrir no sistema</li>
    </ol>
    
    <button onclick="runTest()">üöÄ Executar Teste Completo</button>
    
    <div id="results"></div>
    
    <script>
        function addStatus(message, type = 'info') {\n            const statusDiv = document.getElementById('status');\n            const div = document.createElement('div');\n            div.className = `status ${type}`;\n            div.innerHTML = message;\n            statusDiv.appendChild(div);\n        }\n        \n        function runTest() {\n            document.getElementById('status').innerHTML = '';\n            document.getElementById('results').innerHTML = '';\n            \n            addStatus('üöÄ Iniciando teste do sistema de compartilhamento...', 'info');\n            \n            // Etapa 1: Gerar dados de teste\n            const testProject = {\n                id: 'teste-' + Date.now(),\n                title: 'Projeto de Teste Autom√°tico',\n                image: 'https://pannellum.org/images/alma.jpg',\n                hotspots: [\n                    {\n                        id: 'hotspot_auto_1',\n                        pitch: 0,\n                        yaw: 90,\n                        text: 'Ponto Autom√°tico',\n                        targetImage: 'https://pannellum.org/images/cerro-toco-0.jpg',\n                        parentId: null,\n                        type: 'normal'\n                    }\n                ],\n                logo: null,\n                point: null\n            };\n            \n            addStatus('‚úÖ Etapa 1: Dados de teste gerados', 'success');\n            \n            // Etapa 2: Codificar\n            let encodedData;\n            try {\n                encodedData = btoa(encodeURIComponent(JSON.stringify(testProject)));\n                addStatus('‚úÖ Etapa 2: Dados codificados em Base64', 'success');\n            } catch (e) {\n                addStatus('‚ùå Etapa 2: Erro na codifica√ß√£o - ' + e.message, 'error');\n                return;\n            }\n            \n            // Etapa 3: Criar link\n            const baseUrl = window.location.href.replace('teste-final.html', 'frontend/index.html');\n            const shareUrl = baseUrl + '?share=' + encodedData;\n            addStatus('‚úÖ Etapa 3: Link de compartilhamento criado', 'success');\n            \n            // Etapa 4: Testar decodifica√ß√£o\n            try {\n                const decoded = JSON.parse(decodeURIComponent(atob(encodedData)));\n                if (decoded.title === testProject.title) {\n                    addStatus('‚úÖ Etapa 4: Decodifica√ß√£o bem-sucedida', 'success');\n                } else {\n                    addStatus('‚ùå Etapa 4: Dados decodificados n√£o conferem', 'error');\n                    return;\n                }\n            } catch (e) {\n                addStatus('‚ùå Etapa 4: Erro na decodifica√ß√£o - ' + e.message, 'error');\n                return;\n            }\n            \n            // Etapa 5: Mostrar resultado\n            addStatus('üéâ Teste conclu√≠do com sucesso!', 'success');\n            \n            const resultsDiv = document.getElementById('results');\n            resultsDiv.innerHTML = `\n                <h3>üìã Resultados do Teste:</h3>\n                <div class=\"test-link\">\n                    <strong>Link Gerado:</strong><br>\n                    <a href=\"${shareUrl}\" target=\"_blank\" style=\"word-break: break-all;\">${shareUrl}</a>\n                    <br><br>\n                    <button onclick=\"window.open('${shareUrl}', '_blank')\">üîó Abrir Link de Teste</button>\n                    <button onclick=\"copyToClipboard('${shareUrl}')\">üìã Copiar Link</button>\n                </div>\n                \n                <h4>üìä Dados do Projeto:</h4>\n                <pre>${JSON.stringify(testProject, null, 2)}</pre>\n                \n                <h4>üîê Dados Codificados:</h4>\n                <textarea style=\"width: 100%; height: 100px; font-family: monospace; font-size: 12px;\">${encodedData}</textarea>\n            `;\n        }\n        \n        function copyToClipboard(text) {\n            if (navigator.clipboard) {\n                navigator.clipboard.writeText(text).then(() => {\n                    alert('‚úÖ Link copiado para a √°rea de transfer√™ncia!');\n                }).catch(() => {\n                    fallbackCopy(text);\n                });\n            } else {\n                fallbackCopy(text);\n            }\n        }\n        \n        function fallbackCopy(text) {\n            const textArea = document.createElement('textarea');\n            textArea.value = text;\n            document.body.appendChild(textArea);\n            textArea.select();\n            try {\n                document.execCommand('copy');\n                alert('‚úÖ Link copiado!');\n            } catch (err) {\n                alert('‚ùå Erro ao copiar. Selecione e copie manualmente.');\n            }\n            document.body.removeChild(textArea);\n        }\n        \n        // Auto-executar teste ao carregar\n        window.onload = function() {\n            setTimeout(runTest, 500);\n        };\n    </script>\n</body>\n</html>