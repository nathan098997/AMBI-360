<!DOCTYPE html>
<html>
<head>
    <title>Teste de Compartilhamento AMBI360</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-box { border: 1px solid #ccc; padding: 15px; margin: 10px 0; }
        button { padding: 10px 15px; margin: 5px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Teste do Sistema de Compartilhamento AMBI360</h1>
    
    <div class="test-box">
        <h3>1. Gerar Link de Teste</h3>
        <button onclick="generateTestLink()">Gerar Link de Exemplo</button>
        <div id="testResult"></div>
    </div>
    
    <div class="test-box">
        <h3>2. Testar Decodificação</h3>
        <input type="text" id="testUrl" placeholder="Cole um link aqui" style="width: 100%; padding: 5px;">
        <br><br>
        <button onclick="testDecode()">Testar Decodificação</button>
        <div id="decodeResult"></div>
    </div>

    <script>
        function generateTestLink() {
            const testProject = {
                id: 'projeto-teste',
                title: 'Projeto de Teste',
                image: 'https://pannellum.org/images/alma.jpg',
                hotspots: [
                    {
                        id: 'hotspot_1',
                        pitch: 0,
                        yaw: 90,
                        text: 'Ponto Teste',
                        targetImage: 'https://pannellum.org/images/cerro-toco-0.jpg',
                        parentId: null,
                        type: 'normal'
                    }
                ],
                logo: null,
                point: null
            };
            
            try {
                const encodedData = btoa(encodeURIComponent(JSON.stringify(testProject)));
                const testUrl = window.location.href.split('?')[0].replace('test-share.html', 'index.html') + '?share=' + encodedData;
                
                document.getElementById('testResult').innerHTML = `
                    <div class="success">✅ Link gerado com sucesso!</div>
                    <p><strong>Link:</strong></p>
                    <textarea style="width: 100%; height: 60px;">${testUrl}</textarea>
                    <br><br>
                    <button onclick="copyToClipboard('${testUrl}')">Copiar Link</button>
                    <button onclick="window.open('${testUrl}', '_blank')">Abrir Link</button>
                `;
            } catch (error) {
                document.getElementById('testResult').innerHTML = `
                    <div class="error">❌ Erro ao gerar link: ${error.message}</div>
                `;
            }
        }
        
        function testDecode() {
            const url = document.getElementById('testUrl').value;
            const params = new URLSearchParams(url.split('?')[1] || '');
            const encodedData = params.get('share');
            
            if (!encodedData) {
                document.getElementById('decodeResult').innerHTML = `
                    <div class="error">❌ Nenhum parâmetro 'share' encontrado na URL</div>
                `;
                return;
            }
            
            try {
                const shareData = JSON.parse(decodeURIComponent(atob(encodedData)));
                document.getElementById('decodeResult').innerHTML = `
                    <div class="success">✅ Decodificação bem-sucedida!</div>
                    <pre>${JSON.stringify(shareData, null, 2)}</pre>
                `;
            } catch (error) {
                document.getElementById('decodeResult').innerHTML = `
                    <div class="error">❌ Erro na decodificação: ${error.message}</div>
                `;
            }
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Link copiado para a área de transferência!');
            }).catch(() => {
                alert('Erro ao copiar. Selecione e copie manualmente.');
            });
        }
    </script>
</body>
</html>